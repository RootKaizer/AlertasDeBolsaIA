FROM python:3.10-alpine3.20

# Instalar dependencias necesarias
RUN apk add --no-cache \
    gcc \
    g++ \
    make \
    musl-dev \
    libstdc++ \
    libgcc \
    libffi-dev \
    openssl-dev \
    python3-dev \
    py3-pip \
    lapack-dev \
    openblas-dev \
    openblas \
    gfortran \
    alpine-sdk \
    bash \
    tar \
    curl \
    wget \
    git \
    cmake \
    meson \
    ninja \
    gfortran \
    pkgconfig 

  

# validar version de gcc 
RUN gcc --version

    # validaci√≥n de musl
RUN apk info musl
RUN ldd --version || true



# Directorio de trabajo
WORKDIR /tmp



# Crear entorno virtual
RUN python -m venv /MotorBolsaIA
ENV PATH="/MotorBolsaIA/bin:$PATH"

# Configurar variables de entorno para compilaci√≥n
ENV LDFLAGS="-L/usr/lib"
ENV CFLAGS="-I/usr/include"
ENV OPENBLAS_NUM_THREADS=1

# Actualizar pip
RUN pip install --upgrade pip setuptools wheel cython

# =============================================================================
# PAQUETES CIENT√çFICOS BASE
# =============================================================================
RUN pip install --no-cache-dir \
    numpy==1.26.4 \
    scipy==1.13.1

# =============================================================================
# PAQUETES DE TRADING Y DATOS FINANCIEROS
# =============================================================================
RUN pip install --no-cache-dir \
    pandas==2.2.3 \
    backtrader==1.9.78.123 \
    websocket-client==1.8.0 \
    requests==2.32.3
    
# =============================================================================
# PAQUETES DE GR√ÅFICOS Y VISUALIZACI√ìN
# =============================================================================
RUN pip install --no-cache-dir \
    matplotlib==3.10.0 \
    plotly==6.3.1 \
    seaborn==0.13.2

# =============================================================================
# PAQUETES DE REPORTES Y EXCEL
# =============================================================================
RUN pip install --no-cache-dir \
    openpyxl==3.1.2 \
    xlsxwriter==3.2.0

# =============================================================================
# MACHINE LEARNING Y AN√ÅLISIS
# =============================================================================
RUN pip install --no-cache-dir \
    scikit-learn==1.5.2

# =============================================================================
# PROCESAMIENTO DE TEXTO Y DOCUMENTOS
# =============================================================================
RUN pip install --no-cache-dir \
    beautifulsoup4==4.12.3 \
    lxml==5.2.1 \
    html5lib==1.1 \
    PyPDF2==3.0.1 \
    python-docx==1.1.0

# =============================================================================
# APIS Y COMUNICACI√ìN
# =============================================================================
RUN pip install --no-cache-dir \
    fastapi==0.110.0 \
    uvicorn==0.29.0 \
    pydantic==2.6.4 \
    pydantic-core==2.16.3 \
    httpx==0.27.0 \
    aiohttp==3.9.5

# =============================================================================
# VERIFICACI√ìN POR CATEGOR√çAS
# =============================================================================
RUN python -c "\
print('üî¨ VERIFICANDO PAQUETES CIENT√çFICOS...'); \
import numpy; print(f'  ‚úÖ numpy: {numpy.__version__}'); \
import scipy; print(f'  ‚úÖ scipy: {scipy.__version__}'); \
print(''); \
print('üìà VERIFICANDO PAQUETES DE TRADING...'); \
import pandas; print(f'  ‚úÖ pandas: {pandas.__version__}'); \
import backtrader; print('  ‚úÖ backtrader: OK'); \
import websocket; print('  ‚úÖ websocket: OK'); \
import requests; print(f'  ‚úÖ requests: {requests.__version__}'); \
print(''); \
print('üìä VERIFICANDO PAQUETES DE GR√ÅFICOS...'); \
import matplotlib; print(f'  ‚úÖ matplotlib: {matplotlib.__version__}'); \
import plotly; print(f'  ‚úÖ plotly: {plotly.__version__}'); \
import seaborn; print(f'  ‚úÖ seaborn: {seaborn.__version__}'); \
print(''); \
print('üìã VERIFICANDO PAQUETES DE REPORTES...'); \
import openpyxl; print(f'  ‚úÖ openpyxl: {openpyxl.__version__}'); \
import xlsxwriter; print(f'  ‚úÖ xlsxwriter: {xlsxwriter.__version__}'); \
print(''); \
print('ü§ñ VERIFICANDO MACHINE LEARNING...'); \
import sklearn; print(f'  ‚úÖ scikit-learn: {sklearn.__version__}'); \
print(''); \
print('üéâ TODOS LOS PAQUETES INSTALADOS CORRECTAMENTE');"

# Copiar archivos al contenedor
COPY Program/ /app/

# Establecer permisos
RUN chmod +x /app/scripts/*.py

# Directorio de trabajo
WORKDIR /app

# Exponer puerto si es necesario para APIs
EXPOSE 8000

# Iniciar contenedor
#CMD ["python3", "Start.py", "mediano_plazo"]
CMD ["python3"]

